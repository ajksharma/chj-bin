#!/usr/bin/perl -w

use strict;
use Chj::backtick qw/xbacktick/;
use Chj::xperlfunc;

sub usage {
    print "usage: dpkgS commandname|file/path
";
    exit;
}

usage unless @ARGV;

my $errors=0;

for (@ARGV) {
    if (/^-/) {
	usage
    } else {
	local $/;
	if (! /\//) { # it could be a command
	    my $path= xbacktick("which",$_);
	    if ($? == 0) {
		chop $path;
		$_=$path
	    }
	}
	my $realpath= xbacktick("chase",$_);
	if ($? == 0) {
	    chop $realpath;
	    if (not 0== xsystem "dpkg", "-S", $realpath) {
		$errors++;
	    }
	} else {
	    # a message has already been printed by chase
	    exit 1
	}
    }
}

exit ($errors? 1 : 0);
