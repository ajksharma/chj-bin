#!/bin/bash

# see also (to switch display off entirely): xset dpms force off

set -eu

declare -A bases
bases=(
# Compaq nc2400: \
[0]=/sys/devices/pci0000\:00/0000\:00\:02.0/drm/card0/card0-LVDS-1/intel_backlight/ \
# Thinkpad T61: \
[1]=/sys/devices/pci0000\:00/0000\:00\:01.0/0000\:01\:00.0/backlight/acpi_video0/ \
)

base=""
for b in "${bases[@]}"; do
  if [ -d "$b" ]; then
      if [ -z "$base" ]; then
	  base="$b"
      else
	  echo "multiple path matches, '$base' and '$b', exiting" >&2
	  exit 1
      fi
  fi
done

brightnessfile="$base"/brightness
actual_brightnessfile="$base"/actual_brightness


if ! [ -f "$brightnessfile" ]; then
    echo "$0: missing '$brightnessfile', need adaptions" >&2
    false
fi

case "${1-}" in
    off)
    echo 0 > "$brightnessfile"
    ;;
    on)
    echo 15625 > "$brightnessfile"
    ;;
    mid)
    echo 12625 > "$brightnessfile"
    ;;
    low)
    echo 10625 > "$brightnessfile"
    ;;
    verylow)
    echo 8625 > "$brightnessfile"
    ;;
    status)
    s=`cat "$actual_brightnessfile"`
    case "$s" in
	15625)
	echo on
	;;
	12625)
	echo mid
	;;
	10625)
	echo low
	;;
	8625)
	echo verylow
	;;
	0)
	echo off
	;;
	*)
	echo "?? $s"
	;;
    esac
    ;;
    *)
    echo "$0 on|off|low|verylow|mid|status"
    exit 1
    ;;
esac

